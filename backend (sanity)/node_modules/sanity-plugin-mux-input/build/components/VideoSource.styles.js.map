{"version":3,"file":"VideoSource.styles.js","names":["mediaDimensions","aspect","ImageLoader","memo","alt","src","height","width","suspend","img","Image","decoding","decode","VideoMediaPreview","styled","MediaPreview","VideoMediaPreviewSignedSubtitle","solo","marginTop","undefined","marginBottom","PosterImage","asset","secrets","getPosterSrc","fit_mode","subtitle","useMemo","isSigned","VideoThumbnail","useErrorBoundary","ErrorBoundary","didCatch","error","Math","round","getPlaybackPolicy","message","position","display","justifyContent","alignItems","top","left","right","bottom","ThumbGrid","Grid","CardLoadMore","Card"],"sources":["../../src/components/VideoSource.styles.tsx"],"sourcesContent":["import {MediaPreview} from '@sanity/base/components'\nimport {LockIcon, UnknownIcon} from '@sanity/icons'\nimport {Box, Card, Grid, Inline} from '@sanity/ui'\nimport React, {memo, Suspense, useMemo} from 'react'\nimport styled from 'styled-components'\nimport {suspend} from 'suspend-react'\nimport {useErrorBoundary} from 'use-error-boundary'\n\nimport {getPlaybackPolicy} from '../util/getPlaybackPolicy'\nimport {getPosterSrc} from '../util/getPosterSrc'\nimport {isSigned} from '../util/isSigned'\nimport type {Secrets, VideoAssetDocument} from '../util/types'\n\nconst mediaDimensions = {aspect: 16 / 9}\n\ninterface ImageLoaderProps {\n  alt: string\n  src: string\n  height: number\n  width: number\n}\nconst ImageLoader = memo(function ImageLoader({alt, src, height, width}: ImageLoaderProps) {\n  suspend(async () => {\n    const img = new Image(width, height)\n    img.decoding = 'async'\n    img.src = src\n    await img.decode()\n  }, ['sanity-plugin-mux-input', 'image', src])\n\n  return <img alt={alt} src={src} height={height} width={width} />\n})\n\nconst VideoMediaPreview = styled(MediaPreview)`\n  img {\n    object-fit: cover;\n  }\n`\n\ninterface VideoMediaPreviewSignedSubtitleProps {\n  solo?: boolean\n}\nconst VideoMediaPreviewSignedSubtitle = ({solo}: VideoMediaPreviewSignedSubtitleProps) => {\n  return (\n    <Inline\n      space={1}\n      style={{marginTop: solo ? '-1.35em' : undefined, marginBottom: solo ? undefined : '0.35rem'}}\n    >\n      <LockIcon />\n      Signed playback policy\n    </Inline>\n  )\n}\n\ninterface PosterImageProps extends Omit<ImageLoaderProps, 'src' | 'alt'> {\n  asset: VideoAssetDocument\n  secrets: Secrets\n}\nconst PosterImage = ({asset, height, width, secrets}: PosterImageProps) => {\n  const src = getPosterSrc({asset, secrets, height, width, fit_mode: 'smartcrop'})\n  const subtitle = useMemo(\n    () => (isSigned(asset, secrets) ? <VideoMediaPreviewSignedSubtitle solo /> : undefined),\n    [asset, secrets]\n  )\n\n  // eslint-disable-next-line no-warning-comments\n  // @TODO support setting the alt text in the schema, like how we deal with images\n  return (\n    <VideoMediaPreview\n      mediaDimensions={mediaDimensions}\n      subtitle={subtitle}\n      title={<>{null}</>}\n      media={<ImageLoader alt=\"\" src={src} height={height} width={width} />}\n    />\n  )\n}\n\nexport interface VideoThumbnailProps extends Omit<PosterImageProps, 'height'> {\n  width: number\n}\nexport const VideoThumbnail = memo(function VideoThumbnail({\n  asset,\n  secrets,\n  width,\n}: VideoThumbnailProps) {\n  const {ErrorBoundary, didCatch, error} = useErrorBoundary()\n  const height = Math.round((width * 9) / 16)\n  const subtitle = useMemo(\n    () => (getPlaybackPolicy(asset) === 'signed' ? <VideoMediaPreviewSignedSubtitle /> : undefined),\n    [asset]\n  )\n\n  if (didCatch) {\n    return (\n      <VideoMediaPreview\n        subtitle={error.message}\n        mediaDimensions={mediaDimensions}\n        title=\"Error when loading thumbnail\"\n        media={\n          <Card radius={2} height=\"fill\" style={{position: 'relative', width: '100%'}}>\n            <Box\n              style={{\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n                position: 'absolute',\n                top: 0,\n                left: 0,\n                right: 0,\n                bottom: 0,\n              }}\n            >\n              <UnknownIcon />\n            </Box>\n          </Card>\n        }\n      />\n    )\n  }\n\n  return (\n    <ErrorBoundary>\n      <Suspense\n        fallback={\n          <VideoMediaPreview\n            isPlaceholder\n            title=\"Loading thumbnail...\"\n            subtitle={subtitle}\n            mediaDimensions={mediaDimensions}\n          />\n        }\n      >\n        <PosterImage asset={asset} secrets={secrets} height={height} width={width} />\n      </Suspense>\n    </ErrorBoundary>\n  )\n})\n\nexport const ThumbGrid = styled(Grid)`\n  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));\n`\n\nexport const CardLoadMore = styled(Card)`\n  border-top: 1px solid var(--card-border-color);\n  position: sticky;\n  bottom: 0;\n  z-index: 200;\n`\n"],"mappings":"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"}