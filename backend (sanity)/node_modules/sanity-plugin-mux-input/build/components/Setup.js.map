{"version":3,"file":"Setup.js","names":["MuxVideoInputSetup","Component","uniqueId","token","props","secrets","secretKey","enableSignedUrls","signingKeyId","signingKeyPrivate","isLoading","error","React","createRef","event","setState","currentTarget","value","checked","preventDefault","state","saveSecrets","err","console","hasValidSigningKeys","haveValidSigningKeys","createSigningKeys","data","id","private_key","log","message","onSave","componentDidMount","firstField","current","focus","render","position","handleOnSubmit","tokenInputId","handleTokenChanged","secretKeyInputId","handleSecretKeyChanged","enableSignedUrlsInputId","handleEnableSignedUrls","display","handleSaveToken","onCancel"],"sources":["../../src/components/Setup.tsx"],"sourcesContent":["import {Box, Button, Card, Checkbox, Code, Flex, Inline, Stack, Text, TextInput} from '@sanity/ui'\nimport {uniqueId} from 'lodash'\nimport FormField from 'part:@sanity/components/formfields/default'\nimport React, {Component} from 'react'\n\nimport {createSigningKeys, haveValidSigningKeys, saveSecrets} from '../actions/secrets'\nimport type {Secrets} from '../util/types'\n\nexport interface Props {\n  onSave: (secrets: Secrets) => void\n  onCancel: () => void\n  secrets: Secrets | null\n}\ninterface State extends Secrets {\n  isLoading: boolean\n  error: string | null\n}\nclass MuxVideoInputSetup extends Component<Props, State> {\n  tokenInputId = uniqueId('MuxTokenInput')\n  secretKeyInputId = uniqueId('MuxSecretInput')\n  enableSignedUrlsInputId = uniqueId('MuxEnableSignedUrlsInput')\n\n  state: State = {\n    token: this.props.secrets?.token ?? null,\n    secretKey: this.props.secrets?.secretKey ?? null,\n    enableSignedUrls: this.props.secrets?.enableSignedUrls ?? false,\n    signingKeyId: this.props.secrets?.signingKeyId ?? null,\n    signingKeyPrivate: this.props.secrets?.signingKeyPrivate ?? null,\n    isLoading: false,\n    error: null,\n  }\n\n  firstField = React.createRef<HTMLInputElement>()\n\n  componentDidMount() {\n    this.firstField.current!.focus()\n  }\n\n  handleTokenChanged: React.FormEventHandler<HTMLInputElement> = (event) => {\n    this.setState({token: event.currentTarget.value})\n  }\n\n  handleSecretKeyChanged: React.FormEventHandler<HTMLInputElement> = (event) => {\n    this.setState({secretKey: event.currentTarget.value})\n  }\n\n  handleEnableSignedUrls: React.FormEventHandler<HTMLInputElement> = (event) =>\n    this.setState({enableSignedUrls: event.currentTarget.checked})\n\n  handleOnSubmit: React.FormEventHandler<HTMLFormElement> = (event) => {\n    event.preventDefault()\n  }\n\n  handleSaveToken = async () => {\n    this.setState({isLoading: true})\n\n    const {token, secretKey, enableSignedUrls} = this.state\n    let {signingKeyId, signingKeyPrivate} = this.state\n\n    try {\n      await saveSecrets(token!, secretKey!, enableSignedUrls, signingKeyId!, signingKeyPrivate!)\n    } catch (err) {\n      console.error('Error while trying to save secrets:', err) // eslint-disable-line no-console\n      this.setState({\n        isLoading: false,\n        error: 'Something went wrong saving the token. See console.error for more info.',\n      })\n      return\n    }\n\n    if (enableSignedUrls) {\n      const hasValidSigningKeys = await haveValidSigningKeys(signingKeyId!, signingKeyPrivate!)\n\n      if (!hasValidSigningKeys) {\n        try {\n          const {data} = await createSigningKeys()\n          signingKeyId = data.id\n          signingKeyPrivate = data.private_key\n          await saveSecrets(token!, secretKey!, enableSignedUrls, signingKeyId, signingKeyPrivate)\n        } catch (err: any) {\n          // eslint-disable-next-line no-console\n          console.log('Error while creating and saving signing key:', err?.message)\n          this.setState({error: err?.message!})\n        }\n      }\n    }\n\n    this.setState({isLoading: false})\n\n    this.props.onSave({token, secretKey, enableSignedUrls, signingKeyId, signingKeyPrivate})\n  }\n\n  render() {\n    const {error, isLoading} = this.state\n\n    return (\n      <Box\n        paddingRight={4}\n        paddingLeft={4}\n        paddingBottom={4}\n        paddingTop={4}\n        style={{position: 'relative'}}\n      >\n        <form onSubmit={this.handleOnSubmit}>\n          <Stack space={4}>\n            {!this.state.token && (\n              <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"primary\">\n                <Stack space={3}>\n                  <Text size={1}>\n                    To set up a new access token, go to your{' '}\n                    <a\n                      href=\"https://dashboard.mux.com/settings/access-tokens\"\n                      target=\"_blank\"\n                      rel=\"noreferrer noopener\"\n                    >\n                      account on mux.com\n                    </a>\n                    .\n                  </Text>\n                  <Text size={1}>\n                    The access token needs permissions: <strong>Mux Video </strong>\n                    (Full Access) and <strong>Mux Data</strong> (Read)\n                    <br />\n                    The credentials will be stored safely in a hidden document only available to\n                    editors.\n                  </Text>\n                </Stack>\n              </Card>\n            )}\n            <FormField\n              changeIndicator={false}\n              label=\"Access Token\"\n              labelFor={this.tokenInputId}\n              level={0}\n            >\n              <TextInput\n                id={this.tokenInputId}\n                ref={this.firstField}\n                onChange={this.handleTokenChanged}\n                type=\"text\"\n                value={this.state.token || ''}\n              />\n            </FormField>\n            <FormField\n              changeIndicator={false}\n              label=\"Secret Key\"\n              labelFor={this.secretKeyInputId}\n              level={0}\n            >\n              <TextInput\n                id={this.secretKeyInputId}\n                onChange={this.handleSecretKeyChanged}\n                type=\"text\"\n                value={this.state.secretKey || ''}\n              />\n            </FormField>\n\n            <Stack space={4}>\n              <Flex align=\"center\">\n                <Checkbox\n                  id={this.enableSignedUrlsInputId}\n                  onChange={this.handleEnableSignedUrls}\n                  checked={this.state.enableSignedUrls || false}\n                  style={{display: 'block'}}\n                />\n                <Box flex={1} paddingLeft={3}>\n                  <Text>\n                    <label htmlFor={this.enableSignedUrlsInputId}>Enable Signed Urls</label>\n                  </Text>\n                </Box>\n              </Flex>\n              {this.state.signingKeyId && this.state.enableSignedUrls ? (\n                <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"caution\">\n                  <Stack space={3}>\n                    <Text size={1}>The signing key ID that Sanity will use is:</Text>\n                    <Code size={1}>{this.state.signingKeyId}</Code>\n                    <Text size={1}>\n                      This key is only used for previewing content in the Sanity UI.\n                      <br />\n                      You should generate a different key to use in your application server.\n                    </Text>\n                  </Stack>\n                </Card>\n              ) : null}\n            </Stack>\n\n            <Inline space={2}>\n              <Button\n                text=\"Save\"\n                loading={isLoading}\n                tone=\"primary\"\n                mode=\"default\"\n                onClick={this.handleSaveToken}\n              />\n\n              <Button text=\"Cancel\" tone=\"primary\" mode=\"bleed\" onClick={this.props.onCancel} />\n            </Inline>\n            {error && (\n              <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"critical\">\n                <Text>{error}</Text>\n              </Card>\n            )}\n          </Stack>\n        </form>\n      </Box>\n    )\n  }\n}\n\nexport default MuxVideoInputSetup\n"],"mappings":"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"}