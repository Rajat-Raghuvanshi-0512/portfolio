{"version":3,"file":"Input.js","names":["cachedSecrets","token","secretKey","enableSignedUrls","signingKeyId","signingKeyPrivate","validateSecrets","secrets","getSecrets","Promise","resolve","isInitialSetup","needsSetup","fetchSecrets","then","exists","withDocument","MuxVideoInput","Component","assetDocument","confirmRemove","deleteOnMuxChecked","deleteAssetDocumentChecked","error","hasFocus","isLoading","showSetup","showBrowser","videoReadyToPlay","setState","state","pollInterval","setInterval","getAsset","assetId","response","props","data","client","patch","_id","set","status","commit","returnDocuments","catch","prevState","result","onChange","PatchEvent","from","setIfMissing","asset","_type","_ref","document","setupAssetListener","unsetAsset","reject","unset","undefined","delete","deleteAsset","componentDidMount","value","componentWillUnmount","subscription","unsubscribe","clearInterval","observePaths","pipe","tap","handleRemoveVideo","Error","errors","messages","join","static_renditions","pollMux","config","mp4_support","of","subscribe","render","type","level","markers","position","title","description","styles","formField","handleCancelSaveSetup","handleSaveSetup","handleSetupButtonClicked","handleBlur","handleFocus","handleOnUploadComplete","handleBrowseButton","handleRemoveVideoButtonClicked","readOnly","handleVideoReadyToPlay","handleCloseBrowser","handleSelectAsset","handleCancelRemove","handleDeleteOnMuxCheckBoxClicked","margin","handleDeleteAssetDocumentCheckBoxClicked","handleErrorClose"],"sources":["../../src/components/Input.tsx"],"sourcesContent":["import type {SanityDocument} from '@sanity/types'\nimport {Box, Button, Checkbox, Dialog, Flex, Grid, Inline, Stack, Text} from '@sanity/ui'\nimport {observePaths} from 'part:@sanity/base/preview'\nimport FormField from 'part:@sanity/components/formfields/default'\nimport Spinner from 'part:@sanity/components/loading/spinner'\nimport {withDocument} from 'part:@sanity/form-builder'\nimport PatchEvent, {set, setIfMissing, unset} from 'part:@sanity/form-builder/patch-event'\nimport React, {Component} from 'react'\nimport {of} from 'rxjs'\nimport {tap} from 'rxjs/operators'\n\nimport {deleteAsset, getAsset} from '../actions/assets'\nimport {fetchSecrets} from '../actions/secrets'\nimport client from '../clients/SanityClient'\nimport config from '../config'\nimport type {Secrets, VideoAssetDocument} from '../util/types'\nimport styles from './Input.css'\nimport InputBrowser from './InputBrowser'\nimport InputError from './InputError'\nimport SetupButton from './SetupButton'\nimport SetupNotice from './SetupNotice'\nimport Uploader from './Uploader'\n\nconst cachedSecrets: Secrets = {\n  token: null,\n  secretKey: null,\n  enableSignedUrls: false,\n  signingKeyId: null,\n  signingKeyPrivate: null,\n}\n\nfunction validateSecrets(secrets: Secrets) {\n  if (!secrets.token || !secrets.secretKey) return false\n\n  return true\n}\n\nfunction getSecrets(): Promise<{isInitialSetup: boolean; needsSetup: boolean; secrets: Secrets}> {\n  if (cachedSecrets.token) {\n    return Promise.resolve({\n      isInitialSetup: true,\n      needsSetup: false,\n      secrets: cachedSecrets,\n    })\n  }\n  return fetchSecrets().then(({secrets, exists}) => {\n    cachedSecrets.token = secrets?.token ?? null\n    cachedSecrets.secretKey = secrets?.secretKey ?? null\n    cachedSecrets.enableSignedUrls = secrets?.enableSignedUrls ?? false\n    cachedSecrets.signingKeyId = secrets?.signingKeyId ?? null\n    cachedSecrets.signingKeyPrivate = secrets?.signingKeyPrivate ?? null\n\n    return {\n      isInitialSetup: !exists,\n      needsSetup: !validateSecrets(cachedSecrets),\n      secrets: cachedSecrets,\n    }\n  })\n}\n\ninterface Props {\n  document: SanityDocument\n  value?: null | {asset?: {_type: 'reference'; _ref: string}}\n  type: any\n  level: any\n  markers: any\n  onChange: any\n  readOnly: boolean\n}\n\ninterface State {\n  assetDocument: VideoAssetDocument | null\n  confirmRemove: boolean\n  deleteOnMuxChecked: boolean\n  deleteAssetDocumentChecked: boolean\n  error: Error | null\n  hasFocus: boolean\n  isInitialSetup: boolean\n  isLoading: boolean | 'secrets'\n  needsSetup: boolean\n  secrets: Secrets | null\n  showSetup: boolean\n  showBrowser: boolean\n  videoReadyToPlay: boolean\n}\n\nexport default withDocument(\n  class MuxVideoInput extends Component<Props, State> {\n    state: State = {\n      assetDocument: null,\n      confirmRemove: false,\n      deleteOnMuxChecked: false,\n      deleteAssetDocumentChecked: true,\n      error: null,\n      hasFocus: false,\n      isInitialSetup: true,\n      isLoading: 'secrets',\n      needsSetup: true,\n      secrets: null,\n      showSetup: false,\n      showBrowser: false,\n      videoReadyToPlay: false,\n    }\n\n    pollInterval?: number\n    // eslint-disable-next-line no-warning-comments\n    // @TODO setup proper Observable typings\n    subscription?: any\n\n    componentDidMount() {\n      getSecrets()\n        .then(({secrets, isInitialSetup, needsSetup}) => {\n          this.setState({\n            secrets,\n            isInitialSetup,\n            needsSetup,\n            // If there is an asset continue loading\n            isLoading: !!this.props.value?.asset,\n          })\n        })\n        .catch((error) => this.setState({error}))\n      this.setupAssetListener()\n    }\n\n    componentWillUnmount() {\n      if (this.subscription) {\n        this.subscription.unsubscribe()\n      }\n      if (this.pollInterval) {\n        clearInterval(this.pollInterval)\n        this.pollInterval = undefined\n      }\n    }\n\n    handleFocus = () => {\n      this.setState({hasFocus: true})\n    }\n\n    handleBlur = () => {\n      this.setState({hasFocus: false})\n    }\n\n    getAsset() {\n      const {value} = this.props\n      return value ? value.asset : null\n    }\n\n    setupAssetListener() {\n      if (this.subscription) {\n        this.subscription.unsubscribe()\n      }\n      this.setState({videoReadyToPlay: false})\n      const asset = this.getAsset()\n      if (!asset) {\n        return\n      }\n      this.subscription = observePaths(asset, [\n        'thumbTime',\n        'data',\n        'assetId',\n        'playbackId',\n        'status',\n      ])\n        .pipe(\n          tap((assetDocument: VideoAssetDocument) => {\n            this.setState({assetDocument})\n            if (assetDocument && assetDocument.status === 'errored') {\n              clearInterval(this.pollInterval)\n              this.pollInterval = undefined\n              // eslint-disable-next-line no-warning-comments\n              // todo: use client.observable\n              return this.handleRemoveVideo().then(() => {\n                this.setState({\n                  isLoading: false,\n                  error: new Error(assetDocument.data?.errors?.messages?.join(' ')),\n                })\n              })\n            }\n            // Poll MUX if it's preparing the main document or its own static renditions\n            if (\n              assetDocument?.status === 'preparing' ||\n              assetDocument?.data?.static_renditions?.status === 'preparing'\n            ) {\n              this.pollMux()\n            }\n            // If MP4 support is enabled: MUX will prepare static_renditions only _after_ an asset\n            // has been successfully uploaded.\n            // A _ready_ asset doesn't mean static mp4s are generated and ready for use!\n            // In these cases, wait for `static_renditions.status === 'ready'` before clearing the poll interval.\n            if (assetDocument && assetDocument.status === 'ready') {\n              switch (config.mp4_support) {\n                case 'standard':\n                  if (assetDocument?.data?.static_renditions?.status === 'ready') {\n                    clearInterval(this.pollInterval)\n                    this.pollInterval = undefined\n                  }\n                  break\n                case 'none':\n                default:\n                  clearInterval(this.pollInterval)\n                  this.pollInterval = undefined\n                  break\n              }\n            }\n\n            this.setState({\n              assetDocument,\n              isLoading: false,\n            })\n\n            return of(assetDocument)\n          })\n        )\n        .subscribe()\n    }\n\n    pollMux = () => {\n      const assetDocument = this.state.assetDocument\n      if (!assetDocument) {\n        return\n      }\n      if (this.pollInterval) {\n        return\n      }\n      this.pollInterval = (setInterval as typeof window.setInterval)(() => {\n        getAsset(assetDocument.assetId!)\n          .then((response) => {\n            const props = response.data\n\n            client\n              .patch(assetDocument._id!)\n              .set({\n                status: props.status,\n                data: props,\n              })\n              .commit({returnDocuments: false})\n          })\n          .catch((error) => {\n            this.setState({error})\n          })\n      }, 2000)\n    }\n\n    handleSetupButtonClicked = () => {\n      this.setState((prevState) => ({showSetup: !prevState.showSetup}))\n    }\n\n    handleSaveSetup = ({\n      token,\n      secretKey,\n      enableSignedUrls,\n      signingKeyId,\n      signingKeyPrivate,\n    }: Secrets) => {\n      cachedSecrets.token = token\n      cachedSecrets.secretKey = secretKey\n      cachedSecrets.enableSignedUrls = enableSignedUrls\n      cachedSecrets.signingKeyId = signingKeyId\n      cachedSecrets.signingKeyPrivate = signingKeyPrivate\n\n      this.setState({\n        showSetup: false,\n        secrets: cachedSecrets,\n        needsSetup: !validateSecrets(cachedSecrets),\n      })\n    }\n\n    handleCancelSaveSetup = () => {\n      this.setState({showSetup: false})\n    }\n\n    handleOnUploadComplete = (result: any) => {\n      const {onChange} = this.props\n      const {_id} = result\n      onChange(\n        PatchEvent.from([\n          setIfMissing({asset: {}}),\n          set({_type: 'reference', _ref: _id}, ['asset']),\n        ])\n      )\n      this.setState({assetDocument: result.document}, () => {\n        this.setupAssetListener()\n      })\n    }\n\n    handleRemoveVideoButtonClicked = () => {\n      this.setState({confirmRemove: true})\n    }\n\n    handleRemoveVideo = () => {\n      const {assetDocument} = this.state\n      this.setState({isLoading: true})\n      const unsetAsset = () => {\n        return new Promise<any>((resolve, reject) => {\n          this.setState(\n            {\n              assetDocument: null,\n              confirmRemove: false,\n              isLoading: false,\n            },\n            () => {\n              if (this.state.deleteOnMuxChecked || this.state.deleteAssetDocumentChecked) {\n                return client\n                  .patch(this.props.document._id)\n                  .unset(['video'])\n                  .commit({returnDocuments: false})\n                  .then(() => {\n                    if (!assetDocument) {\n                      return resolve(undefined)\n                    }\n                    return client\n                      .delete(assetDocument._id!)\n                      .then(() => {\n                        resolve(undefined)\n                      })\n                      .catch((error) => {\n                        reject(error)\n                      })\n                  })\n              }\n              return this.props.onChange(PatchEvent.from(unset()))\n            }\n          )\n        })\n      }\n      return unsetAsset()\n        .then(() => {\n          if (this.state.deleteOnMuxChecked) {\n            return deleteAsset(assetDocument!.assetId!).catch((error) => {\n              this.setState({error})\n            })\n          }\n          return true as any\n        })\n        .catch((error) => {\n          this.setState({error})\n        })\n    }\n\n    handleCancelRemove = () => {\n      this.setState({\n        confirmRemove: false,\n        deleteOnMuxChecked: true,\n        deleteAssetDocumentChecked: true,\n      })\n    }\n\n    handleDeleteOnMuxCheckBoxClicked = () => {\n      this.setState((prevState) => ({\n        deleteOnMuxChecked: !prevState.deleteOnMuxChecked,\n      }))\n    }\n\n    handleDeleteAssetDocumentCheckBoxClicked = () => {\n      this.setState((prevState) => ({\n        deleteAssetDocumentChecked: !prevState.deleteAssetDocumentChecked,\n      }))\n    }\n\n    handleErrorClose = () => {\n      this.setState({\n        error: null,\n      })\n    }\n\n    handleBrowseButton = () => {\n      this.setState({showBrowser: true})\n    }\n\n    handleCloseBrowser = () => {\n      this.setState({showBrowser: false})\n    }\n\n    handleSelectAsset = (asset: VideoAssetDocument) => {\n      const {onChange} = this.props\n\n      onChange(\n        PatchEvent.from([\n          setIfMissing({asset: {}}),\n          set({_type: 'reference', _ref: asset._id}, ['asset']),\n        ])\n      )\n\n      this.setState({showBrowser: false, assetDocument: asset}, () => {\n        this.setupAssetListener()\n      })\n    }\n\n    handleVideoReadyToPlay = () => {\n      this.setState({videoReadyToPlay: true})\n    }\n\n    render() {\n      const {type, level, markers} = this.props\n\n      return (\n        <>\n          <Box style={{position: 'relative'}}>\n            <Flex align=\"center\" justify=\"space-between\">\n              <FormField\n                label={type.title}\n                markers={markers}\n                description={type.description}\n                level={level}\n                className={styles.formField}\n              />\n              <SetupButton\n                isLoading={this.state.isLoading}\n                needsSetup={this.state.needsSetup}\n                onCancel={this.handleCancelSaveSetup}\n                onSave={this.handleSaveSetup}\n                onSetup={this.handleSetupButtonClicked}\n                secrets={this.state.secrets}\n                showSetup={this.state.showSetup}\n              />\n            </Flex>\n            {this.state.isLoading === 'secrets' && (\n              <Box marginBottom={2}>\n                <Inline space={2}>\n                  <Spinner inline />\n                  <Text size={1}>Fetching credentials</Text>\n                </Inline>\n              </Box>\n            )}\n\n            {this.state.needsSetup && (\n              <SetupNotice\n                isLoading={this.state.isLoading}\n                isInitialSetup={this.state.isInitialSetup}\n              />\n            )}\n\n            {!this.state.needsSetup && this.state.secrets && (\n              <Uploader\n                hasFocus={this.state.hasFocus}\n                onBlur={this.handleBlur}\n                onFocus={this.handleFocus}\n                onSetupButtonClicked={this.handleSetupButtonClicked}\n                onUploadComplete={this.handleOnUploadComplete}\n                secrets={this.state.secrets}\n                onBrowse={this.handleBrowseButton}\n                asset={this.state.assetDocument!}\n                onRemove={this.handleRemoveVideoButtonClicked}\n                readOnly={this.props.readOnly}\n                handleVideoReadyToPlay={this.handleVideoReadyToPlay}\n                videoReadyToPlay={this.state.videoReadyToPlay}\n                handleRemoveVideo={this.handleRemoveVideo}\n              />\n            )}\n\n            {this.state.showBrowser && (\n              <InputBrowser\n                onClose={this.handleCloseBrowser}\n                onSelect={this.handleSelectAsset}\n                secrets={this.state.secrets!}\n              />\n            )}\n\n            {this.state.confirmRemove && (\n              <Dialog\n                id=\"remove-video\"\n                header=\"Remove video\"\n                zOffset={1000}\n                onClose={this.handleCancelRemove}\n              >\n                <Box padding={4}>\n                  <Stack space={3}>\n                    <Flex align=\"center\">\n                      <Checkbox\n                        checked={this.state.deleteOnMuxChecked}\n                        onChange={this.handleDeleteOnMuxCheckBoxClicked}\n                      />\n                      <Text style={{margin: '0 10px'}}>Delete asset on Mux</Text>\n                    </Flex>\n                    <Flex align=\"center\">\n                      <Checkbox\n                        disabled={this.state.deleteOnMuxChecked}\n                        checked={\n                          this.state.deleteOnMuxChecked || this.state.deleteAssetDocumentChecked\n                        }\n                        onChange={this.handleDeleteAssetDocumentCheckBoxClicked}\n                      />\n                      <Text style={{margin: '0 10px'}}>Delete video from dataset</Text>\n                    </Flex>\n                    <Grid columns={2} gap={2}>\n                      <Button\n                        mode=\"ghost\"\n                        tone=\"default\"\n                        text=\"Cancel\"\n                        onClick={this.handleCancelRemove}\n                        loading={!!this.state.isLoading}\n                      />\n                      <Button\n                        mode=\"default\"\n                        tone=\"critical\"\n                        text=\"Remove\"\n                        onClick={this.handleRemoveVideo}\n                        loading={!!this.state.isLoading}\n                      />\n                    </Grid>\n                  </Stack>\n                </Box>\n              </Dialog>\n            )}\n\n            {this.state.error && (\n              <InputError error={this.state.error} onClose={this.handleErrorClose} />\n            )}\n          </Box>\n        </>\n      )\n    }\n  }\n)\n"],"mappings":"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"}