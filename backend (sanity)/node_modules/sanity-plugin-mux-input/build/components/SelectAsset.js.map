{"version":3,"file":"SelectAsset.js","names":["PER_PAGE","createQuery","start","end","SelectAssets","onSelect","secrets","pageNoRef","useRef","useState","isLastPage","setLastPage","isLoading","setLoading","assets","setAssets","fetchPage","useCallback","pageNo","client","fetch","then","result","length","prev","concat","finally","handleSelect","id","selected","find","doc","_id","TypeError","handleLoadMore","current","useEffect"],"sources":["../../src/components/SelectAsset.tsx"],"sourcesContent":["import React, {useCallback, useEffect, useRef, useState} from 'react'\n\nimport client from '../clients/SanityClient'\nimport type {Secrets, VideoAssetDocument} from '../util/types'\nimport VideoSource, {type Props as VideoSourceProps} from './VideoSource'\n\nconst PER_PAGE = 20\n\nfunction createQuery(start = 0, end = PER_PAGE) {\n  return /* groq */ `*[_type == \"mux.videoAsset\"] | order(_updatedAt desc) [${start}...${end}] {_id, playbackId, thumbTime, data}`\n}\n\nexport interface Props {\n  onSelect: (asset: VideoAssetDocument) => void\n  secrets: Secrets\n}\n\nexport default function SelectAssets({onSelect, secrets}: Props) {\n  const pageNoRef = useRef(0)\n  const [isLastPage, setLastPage] = useState(false)\n  const [isLoading, setLoading] = useState(false)\n  const [assets, setAssets] = useState<VideoAssetDocument[]>([])\n\n  const fetchPage = useCallback((pageNo: number) => {\n    const start = pageNo * PER_PAGE\n    const end = start + PER_PAGE\n    setLoading(true)\n    return client\n      .fetch(createQuery(start, end))\n      .then((result: VideoAssetDocument[]) => {\n        setLastPage(result.length < PER_PAGE)\n        setAssets((prev) => prev.concat(result))\n      })\n      .finally(() => setLoading(false))\n  }, [])\n  const handleSelect = useCallback<VideoSourceProps['onSelect']>(\n    (id) => {\n      const selected = assets.find((doc) => doc._id === id)\n      if (!selected) {\n        throw new TypeError(`Failed to find video asset with id: ${id}`)\n      }\n      onSelect(selected)\n    },\n    [assets, onSelect]\n  )\n  const handleLoadMore = useCallback<VideoSourceProps['onLoadMore']>(() => {\n    fetchPage(++pageNoRef.current)\n  }, [fetchPage])\n\n  useEffect(() => void fetchPage(pageNoRef.current), [fetchPage])\n\n  return (\n    <VideoSource\n      onSelect={handleSelect}\n      assets={assets}\n      isLastPage={isLastPage}\n      isLoading={isLoading}\n      onLoadMore={handleLoadMore}\n      secrets={secrets}\n    />\n  )\n}\n"],"mappings":";;;;;;AAAA;AAEA;AAEA;AAAyE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEzE,IAAMA,QAAQ,GAAG,EAAE;AAEnB,SAASC,WAAW,GAA4B;EAAA,IAA3BC,KAAK,uEAAG,CAAC;EAAA,IAAEC,GAAG,uEAAGH,QAAQ;EAC5C,OAAO,8EAAqEE,KAAK,gBAAMC,GAAG;EAAA;AAC5F;AAOe,SAASC,YAAY,OAA6B;EAAA,IAA3BC,QAAQ,QAARA,QAAQ;IAAEC,OAAO,QAAPA,OAAO;EACrD,IAAMC,SAAS,GAAG,IAAAC,aAAM,EAAC,CAAC,CAAC;EAC3B,gBAAkC,IAAAC,eAAQ,EAAC,KAAK,CAAC;IAAA;IAA1CC,UAAU;IAAEC,WAAW;EAC9B,iBAAgC,IAAAF,eAAQ,EAAC,KAAK,CAAC;IAAA;IAAxCG,SAAS;IAAEC,UAAU;EAC5B,iBAA4B,IAAAJ,eAAQ,EAAuB,EAAE,CAAC;IAAA;IAAvDK,MAAM;IAAEC,SAAS;EAExB,IAAMC,SAAS,GAAG,IAAAC,kBAAW,EAAEC,MAAc,IAAK;IAChD,IAAMhB,KAAK,GAAGgB,MAAM,GAAGlB,QAAQ;IAC/B,IAAMG,GAAG,GAAGD,KAAK,GAAGF,QAAQ;IAC5Ba,UAAU,CAAC,IAAI,CAAC;IAChB,OAAOM,qBAAM,CACVC,KAAK,CAACnB,WAAW,CAACC,KAAK,EAAEC,GAAG,CAAC,CAAC,CAC9BkB,IAAI,CAAEC,MAA4B,IAAK;MACtCX,WAAW,CAACW,MAAM,CAACC,MAAM,GAAGvB,QAAQ,CAAC;MACrCe,SAAS,CAAES,IAAI,IAAKA,IAAI,CAACC,MAAM,CAACH,MAAM,CAAC,CAAC;IAC1C,CAAC,CAAC,CACDI,OAAO,CAAC,MAAMb,UAAU,CAAC,KAAK,CAAC,CAAC;EACrC,CAAC,EAAE,EAAE,CAAC;EACN,IAAMc,YAAY,GAAG,IAAAV,kBAAW,EAC7BW,EAAE,IAAK;IACN,IAAMC,QAAQ,GAAGf,MAAM,CAACgB,IAAI,CAAEC,GAAG,IAAKA,GAAG,CAACC,GAAG,KAAKJ,EAAE,CAAC;IACrD,IAAI,CAACC,QAAQ,EAAE;MACb,MAAM,IAAII,SAAS,+CAAwCL,EAAE,EAAG;IAClE;IACAvB,QAAQ,CAACwB,QAAQ,CAAC;EACpB,CAAC,EACD,CAACf,MAAM,EAAET,QAAQ,CAAC,CACnB;EACD,IAAM6B,cAAc,GAAG,IAAAjB,kBAAW,EAAiC,MAAM;IACvED,SAAS,CAAC,EAAET,SAAS,CAAC4B,OAAO,CAAC;EAChC,CAAC,EAAE,CAACnB,SAAS,CAAC,CAAC;EAEf,IAAAoB,gBAAS,EAAC,MAAM,KAAKpB,SAAS,CAACT,SAAS,CAAC4B,OAAO,CAAC,EAAE,CAACnB,SAAS,CAAC,CAAC;EAE/D,oBACE,6BAAC,oBAAW;IACV,QAAQ,EAAEW,YAAa;IACvB,MAAM,EAAEb,MAAO;IACf,UAAU,EAAEJ,UAAW;IACvB,SAAS,EAAEE,SAAU;IACrB,UAAU,EAAEsB,cAAe;IAC3B,OAAO,EAAE5B;EAAQ,EACjB;AAEN"}