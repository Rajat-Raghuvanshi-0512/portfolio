{"version":3,"file":"getVideoSrc.js","names":["getVideoSrc","asset","secrets","playbackId","getPlaybackId","searchParams","URLSearchParams","isSigned","token","generateJwt","signingKeyId","signingKeyPrivate","set"],"sources":["../../src/util/getVideoSrc.ts"],"sourcesContent":["import {generateJwt} from './generateJwt'\nimport {getPlaybackId} from './getPlaybackId'\nimport {isSigned} from './isSigned'\nimport type {MuxVideoUrl, Secrets, SignableSecrets, VideoAssetDocument} from './types'\n\ninterface VideoSrcOptions {\n  asset: VideoAssetDocument\n  secrets: Secrets | SignableSecrets\n}\n\nexport function getVideoSrc({asset, secrets}: VideoSrcOptions): MuxVideoUrl {\n  const playbackId = getPlaybackId(asset)\n  const searchParams = new URLSearchParams()\n\n  if (isSigned(asset, secrets as SignableSecrets)) {\n    const token = generateJwt(\n      playbackId,\n      // eslint-disable-next-line no-warning-comments\n      // @TODO figure out why isSigned doesn't manage to narrow down secrets to SignableSecrets\n      (secrets as SignableSecrets).signingKeyId,\n      (secrets as SignableSecrets).signingKeyPrivate,\n      'v'\n    )\n    searchParams.set('token', token)\n  }\n\n  return `https://stream.mux.com/${playbackId}.m3u8?${searchParams}`\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AAQO,SAASA,WAAW,OAAiD;EAAA,IAA/CC,KAAK,QAALA,KAAK;IAAEC,OAAO,QAAPA,OAAO;EACzC,IAAMC,UAAU,GAAG,IAAAC,4BAAa,EAACH,KAAK,CAAC;EACvC,IAAMI,YAAY,GAAG,IAAIC,eAAe,EAAE;EAE1C,IAAI,IAAAC,kBAAQ,EAACN,KAAK,EAAEC,OAAO,CAAoB,EAAE;IAC/C,IAAMM,KAAK,GAAG,IAAAC,wBAAW,EACvBN,UAAU;IACV;IACA;IACCD,OAAO,CAAqBQ,YAAY,EACxCR,OAAO,CAAqBS,iBAAiB,EAC9C,GAAG,CACJ;IACDN,YAAY,CAACO,GAAG,CAAC,OAAO,EAAEJ,KAAK,CAAC;EAClC;EAEA,wCAAiCL,UAAU,mBAASE,YAAY;AAClE"}