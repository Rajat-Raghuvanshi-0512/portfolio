{"version":3,"file":"extractFiles.js","names":["extractDroppedFiles","dataTransfer","files","Array","from","items","length","Promise","resolve","normalizeItems","then","arr","flat","all","map","item","kind","webkitGetAsEntry","entry","err","getAsFile","isDirectory","walk","file","getAsString","str","File","type","isFile","dir","createReader","readEntries","entries","filter","entr","name","startsWith"],"sources":["../../src/util/extractFiles.ts"],"sourcesContent":["/**\n * Utilities for extracting files from dataTransfer in a predictable cross-browser fashion.\n * Also recursively extracts files from a directory\n * Inspired by https://github.com/component/normalized-upload\n */\n\nexport function extractDroppedFiles(dataTransfer: DataTransfer) {\n  const files = Array.from(dataTransfer.files || [])\n  const items = Array.from(dataTransfer.items || [])\n  if (files && files.length > 0) {\n    return Promise.resolve(files)\n  }\n  return normalizeItems(items).then((arr) => arr.flat())\n}\n\nfunction normalizeItems(items: DataTransferItem[]) {\n  return Promise.all(\n    items.map((item) => {\n      // directory\n      if (item.kind === 'file' && item.webkitGetAsEntry) {\n        let entry: FileSystemEntry | File[]\n        // Edge throws\n        try {\n          entry = item.webkitGetAsEntry()\n        } catch (err) {\n          return [item.getAsFile()]\n        }\n        if (!entry) {\n          return []\n        }\n        return entry.isDirectory ? walk(entry) : [item.getAsFile()]\n      }\n\n      // file\n      if (item.kind === 'file') {\n        const file = item.getAsFile()\n        return Promise.resolve(file ? [file] : [])\n      }\n\n      // others\n      return new Promise((resolve) => item.getAsString(resolve)).then((str?: string) =>\n        str ? [new File([str], 'unknown.txt', {type: item.type})] : []\n      )\n    })\n  )\n}\n\nfunction isFile(entry: FileSystemEntry): entry is FileSystemFileEntry {\n  return entry.isFile\n}\nfunction isDirectory(entry: FileSystemEntry): entry is FileSystemDirectoryEntry {\n  return entry.isDirectory\n}\n\nfunction walk(entry: FileSystemEntry) {\n  if (isFile(entry)) {\n    return new Promise((resolve) => entry.file(resolve)).then((file) => [file])\n  }\n\n  if (isDirectory(entry)) {\n    const dir = entry.createReader()\n    return new Promise((resolve) => dir.readEntries(resolve))\n      .then((entries: FileSystemEntry[]) => entries.filter((entr) => !entr.name.startsWith('.')))\n      .then((entries) => Promise.all(entries.map(walk)).then((arr) => arr.flat()))\n  }\n  return Promise.resolve([])\n}\n"],"mappings":"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"}