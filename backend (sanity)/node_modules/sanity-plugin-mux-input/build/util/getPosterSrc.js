"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getPosterSrc = getPosterSrc;
var _generateJwt = require("./generateJwt");
var _getPlaybackId = require("./getPlaybackId");
var _isSigned = require("./isSigned");
function getPosterSrc(_ref) {
  var asset = _ref.asset,
    secrets = _ref.secrets,
    fit_mode = _ref.fit_mode,
    height = _ref.height,
    _ref$time = _ref.time,
    time = _ref$time === void 0 ? asset.thumbTime : _ref$time,
    width = _ref.width;
  var params = {
    fit_mode,
    height,
    time,
    width
  };
  var playbackId = (0, _getPlaybackId.getPlaybackId)(asset);
  var searchParams = new URLSearchParams(JSON.parse(JSON.stringify(params, (_, v) => v !== null && v !== void 0 ? v : undefined)));
  if ((0, _isSigned.isSigned)(asset, secrets)) {
    var token = (0, _generateJwt.generateJwt)(playbackId,
    // eslint-disable-next-line no-warning-comments
    // @TODO figure out why isSigned doesn't manage to narrow down secrets to SignableSecrets
    secrets.signingKeyId, secrets.signingKeyPrivate, 't', params);
    searchParams = new URLSearchParams({
      token
    });
  }
  return "https://image.mux.com/".concat(playbackId, "/thumbnail.png?").concat(searchParams);
}
//# sourceMappingURL=getPosterSrc.js.map