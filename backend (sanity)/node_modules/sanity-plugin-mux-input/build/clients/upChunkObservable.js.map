{"version":3,"file":"upChunkObservable.js","names":["createUpChunkObservable","uuid","uploadUrl","source","Observable","subscriber","upchunk","UpChunk","createUpload","endpoint","file","chunkSize","successHandler","next","type","id","complete","errorHandler","data","error","Error","detail","message","progressHandler","percent","offlineHandler","pause","onlineHandler","resume","on","abort"],"sources":["../../src/clients/upChunkObservable.ts"],"sourcesContent":["import * as UpChunk from '@mux/upchunk'\nimport {Observable} from 'rxjs'\n\nexport function createUpChunkObservable(uuid: string, uploadUrl: string, source: File) {\n  return new Observable((subscriber) => {\n    const upchunk = UpChunk.createUpload({\n      endpoint: uploadUrl,\n      file: source,\n      chunkSize: 30720, // Uploads the file in 30 MB chunks\n    })\n\n    const successHandler = () => {\n      subscriber.next({\n        type: 'success',\n        id: uuid,\n      })\n      subscriber.complete()\n    }\n\n    const errorHandler = (data: CustomEvent) => subscriber.error(new Error(data.detail.message))\n\n    const progressHandler = (data: CustomEvent) => {\n      return subscriber.next({type: 'progress', percent: data.detail})\n    }\n\n    const offlineHandler = () => {\n      upchunk.pause()\n      subscriber.next({\n        type: 'pause',\n        id: uuid,\n      })\n    }\n\n    const onlineHandler = () => {\n      upchunk.resume()\n      subscriber.next({\n        type: 'resume',\n        id: uuid,\n      })\n    }\n\n    upchunk.on('success', successHandler)\n    upchunk.on('error', errorHandler)\n    upchunk.on('progress', progressHandler)\n    upchunk.on('offline', offlineHandler)\n    upchunk.on('online', onlineHandler)\n\n    return () => upchunk.abort()\n  })\n}\n"],"mappings":";;;;;;AAAA;AACA;AAA+B;AAAA;AAExB,SAASA,uBAAuB,CAACC,IAAY,EAAEC,SAAiB,EAAEC,MAAY,EAAE;EACrF,OAAO,IAAIC,gBAAU,CAAEC,UAAU,IAAK;IACpC,IAAMC,OAAO,GAAGC,OAAO,CAACC,YAAY,CAAC;MACnCC,QAAQ,EAAEP,SAAS;MACnBQ,IAAI,EAAEP,MAAM;MACZQ,SAAS,EAAE,KAAK,CAAE;IACpB,CAAC,CAAC;;IAEF,IAAMC,cAAc,GAAG,MAAM;MAC3BP,UAAU,CAACQ,IAAI,CAAC;QACdC,IAAI,EAAE,SAAS;QACfC,EAAE,EAAEd;MACN,CAAC,CAAC;MACFI,UAAU,CAACW,QAAQ,EAAE;IACvB,CAAC;IAED,IAAMC,YAAY,GAAIC,IAAiB,IAAKb,UAAU,CAACc,KAAK,CAAC,IAAIC,KAAK,CAACF,IAAI,CAACG,MAAM,CAACC,OAAO,CAAC,CAAC;IAE5F,IAAMC,eAAe,GAAIL,IAAiB,IAAK;MAC7C,OAAOb,UAAU,CAACQ,IAAI,CAAC;QAACC,IAAI,EAAE,UAAU;QAAEU,OAAO,EAAEN,IAAI,CAACG;MAAM,CAAC,CAAC;IAClE,CAAC;IAED,IAAMI,cAAc,GAAG,MAAM;MAC3BnB,OAAO,CAACoB,KAAK,EAAE;MACfrB,UAAU,CAACQ,IAAI,CAAC;QACdC,IAAI,EAAE,OAAO;QACbC,EAAE,EAAEd;MACN,CAAC,CAAC;IACJ,CAAC;IAED,IAAM0B,aAAa,GAAG,MAAM;MAC1BrB,OAAO,CAACsB,MAAM,EAAE;MAChBvB,UAAU,CAACQ,IAAI,CAAC;QACdC,IAAI,EAAE,QAAQ;QACdC,EAAE,EAAEd;MACN,CAAC,CAAC;IACJ,CAAC;IAEDK,OAAO,CAACuB,EAAE,CAAC,SAAS,EAAEjB,cAAc,CAAC;IACrCN,OAAO,CAACuB,EAAE,CAAC,OAAO,EAAEZ,YAAY,CAAC;IACjCX,OAAO,CAACuB,EAAE,CAAC,UAAU,EAAEN,eAAe,CAAC;IACvCjB,OAAO,CAACuB,EAAE,CAAC,SAAS,EAAEJ,cAAc,CAAC;IACrCnB,OAAO,CAACuB,EAAE,CAAC,QAAQ,EAAEF,aAAa,CAAC;IAEnC,OAAO,MAAMrB,OAAO,CAACwB,KAAK,EAAE;EAC9B,CAAC,CAAC;AACJ"}